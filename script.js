// مصفوفة تحتوي على جميع الأسئلة (53 سؤالاً) بناءً على ما أرسلته
const questions = [
    // --- أسئلة الصح والخطأ ---
    { q: "قانون الطلب يوضح العلاقة الطردية بين السعر والكمية المطلوبة", a: ["صح", "غلط"], c: "غلط" },
    { q: "الدخل الحقيقي أكبر من الدخل النقدي", a: ["صح", "غلط"], c: "غلط" },
    { q: "في حالة الأزمات والحروب قد يكون هناك علاقة طردية بين السعر والكمية المطلوبة", a: ["صح", "غلط"], c: "صح" },
    { q: "إذا كانت مرونة العرض تساوي واحد فإن العرض يكون متكافئ المرونة", a: ["صح", "غلط"], c: "صح" },
    { q: "نقطة التوازن السوق هي النقطة التي يتساوي عندها الكمية المطلوبة مع الكمية المعروضة", a: ["صح", "غلط"], c: "صح" }, // تصحيح: هي نقطة التساوي فعلياً
    { q: "الإنتاج أو العملية الإنتاجية تعني خلق الشيء", a: ["صح", "غلط"], c: "غلط" },
    { q: "بزيادة استهلاك الفرد من وحدات السلع تتناقص المنفعة الحدية", a: ["صح", "غلط"], c: "صح" },
    { q: "تفترض نظرية المنفعة الحدية إمكانية قياس وحدات المنفعة بوحدات قياس محددة", a: ["صح", "غلط"], c: "صح" },
    { q: "المنفعة المكانية تعني نقل السلعة من مكان يقل الطلب عليه لمكان يكثر عليه الطلب", a: ["صح", "غلط"], c: "صح" },
    { q: "رأس المال الثابت هو رأس المال الذي يستخدم أكثر من مرة في العملية الإنتاجية", a: ["صح", "غلط"], c: "صح" },
    { q: "الناتج الكلي يمثل الكمية المنتجة من السلعة باستخدام قدر معين من العناصر الإنتاجية", a: ["صح", "غلط"], c: "صح" },
    { q: "التكاليف الثابتة هي التكاليف التي تتغير مع حجم الإنتاج", a: ["صح", "غلط"], c: "غلط" },
    { q: "العلاقة بين الكمية المطلوبة ودخل المستهلك في حالة السلعة الرديئة هي علاقة طردية", a: ["صح", "غلط"], c: "غلط" },
    { q: "الآلات من السلع الإنتاجية المعمرة", a: ["صح", "غلط"], c: "صح" },
    { q: "من محددات العرض التنبؤ بأسعار المستقبل", a: ["صح", "غلط"], c: "صح" },
    { q: "في دالة العرض العلاقة بين السعر والكمية المعروضة هي علاقة عكسية", a: ["صح", "غلط"], c: "غلط" },
    { q: "يصعب زيادة المعروض من عنصر العمل في المدى القصير", a: ["صح", "غلط"], c: "صح" },
    { q: "المنفعة الحدية تمثل منفعة آخر وحدة مستهلكة من السلع", a: ["صح", "غلط"], c: "صح" },

    // --- أسئلة الاختياري ---
    { q: "من السلع الاستهلاكية غير المعمرة:", a: ["الآلات والأكل", "الثلاجة والغسالة"], c: "الآلات والأكل" },
    { q: "من السلع الإنتاجية المعمرة:", a: ["الآلات", "الأكل", "الثلاجة والغسالة"], c: "الآلات" },
    { q: "من أهم عناصر الإنتاج:", a: ["الأرض", "رأس المال والعمل", "جميع ما سبق"], c: "جميع ما سبق" },
    { q: "العلم الذي يحاول سد احتياجات البشر في حدود الموارد المتاحة:", a: ["علم الاجتماع", "علم الاقتصاد", "علم النفس"], c: "علم الاقتصاد" },
    { q: "إذا كانت مرونة الطلب السعرية تساوي -2 فإن الطلب يكون:", a: ["مرن", "غير مرن", "عديم المرونة"], c: "مرن" },
    { q: "إذا كانت مرونة العرض السعرية تساوي 0.5 فإن العرض يكون:", a: ["مرن", "غير مرن", "متكافئ"], c: "غير مرن" },
    { q: "إذا كانت مرونة الطلب الداخلية تساوي -3 فإن السلعة تكون:", a: ["رديئة", "عادية", "ضرورية"], c: "رديئة" },
    { q: "من محددات الطلب:", a: ["سعر السلعة نفسها", "سعر السلع الأخرى", "جميع ما سبق"], c: "جميع ما سبق" },
    { q: "المنفعة التي تنشأ عن نقل ملكية السلعة من شخص إلى شخص آخر:", a: ["تملكية", "شخصية", "كمالية"], c: "تملكية" },
    { q: "المنفعة التي تنشأ عن تخزين السلعة من وقت يقل فيه الطلب لوقت يزيد فيه:", a: ["تملكية", "كمية", "زمنية"], c: "زمنية" },
    { q: "المنحنى الذي يعطي مختلف التوليفات من سلعتين:", a: ["منحنى الطلب", "منحنى السواء", "منحنى العرض"], c: "منحنى السواء" },
    { q: "في دالة التكاليف يكون العامل التابع هو:", a: ["التكاليف", "الإنتاج", "عناصر الإنتاج"], c: "التكاليف" },
    { q: "من أنواع الأسواق التي يسود فيها بائع واحد فقط:", a: ["المنافسة الكاملة", "الاحتكار", "منافسة القلة"], c: "الاحتكار" },
    { q: "السوق الذي يوجد فيه عدد قليل من البائعين:", a: ["المنافسة الكاملة", "الاحتكار", "منافسة القلة"], c: "منافسة القلة" },
    { q: "من السلع الحرة:", a: ["الملابس", "الأكل", "الأمطار"], c: "الأمطار" }
    
];

let currentIdx = 0;
let score = 0;
let shuffledQs = [];

const qEl = document.getElementById('question');
const optEl = document.getElementById('options');
const nextBtn = document.getElementById('next-btn');
const scoreEl = document.getElementById('score');
const countEl = document.getElementById('q-count');
const progress = document.getElementById('progress');

function startQuiz() {
    // خلط جميع الأسئلة لضمان عدم التوقف
    shuffledQs = [...questions].sort(() => Math.random() - 0.5);
    currentIdx = 0;
    score = 0;
    renderQuestion();
}

function renderQuestion() {
    optEl.innerHTML = '';
    nextBtn.classList.add('hide');
    
    let q = shuffledQs[currentIdx];
    qEl.innerText = q.q;
    countEl.innerText = currentIdx + 1;
    
    // تحديث شريط التقدم بناءً على العدد الكلي الفعلي
    progress.style.width = `${((currentIdx + 1) / shuffledQs.length) * 100}%`;

    q.a.forEach(option => {
        const btn = document.createElement('button');
        btn.innerText = option;
        btn.classList.add('option');
        btn.onclick = () => {
            if (option === q.c) {
                btn.classList.add('correct');
                score++;
                scoreEl.innerText = score;
            } else {
                btn.classList.add('wrong');
                // إظهار الإجابة الصحيحة
                Array.from(optEl.children).forEach(b => {
                    if(b.innerText === q.c) b.classList.add('correct');
                });
            }
            Array.from(optEl.children).forEach(b => b.disabled = true);
            nextBtn.classList.remove('hide');
        };
        optEl.appendChild(btn);
    });
}

nextBtn.onclick = () => {
    currentIdx++;
    if (currentIdx < shuffledQs.length) {
        renderQuestion();
        window.scrollTo(0, 0); // العودة للأعلى في الموبايل
    } else {
        qEl.innerText = `انتهى الاختبار! نتيجتك النهائية هي ${score} من ${shuffledQs.length}`;
        optEl.innerHTML = `<button onclick="location.reload()" style="width:100%; padding:15px; background:#28a745; color:white; border:none; border-radius:8px;">إعادة المحاولة</button>`;
        nextBtn.classList.add('hide');
    }
};

document.addEventListener('DOMContentLoaded', startQuiz);